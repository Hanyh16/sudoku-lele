import { strategyGrid } from '@sudoku/stores/grid';
import { strategyManager } from '@sudoku/strategy/strategyManager';
import { cursor } from '@sudoku/stores/cursor';

export const gotoTimeStep = (timeStep) => {
  strategyGrid.setTimeStep(timeStep);
};

export const rollbackAllCellsTo = (timeStep) => {
  strategyGrid.getStrategyGrid().update(($strategyGrid) => {
    $strategyGrid.map((row) => row.map((cell) => cell.branchBack(timeStep)));
    return $strategyGrid;
  });
};

export const recomputeCandidates = (positions = null) => {
  strategyGrid.updateCellCandidates(positions ?? null);
};

export const refreshAfterTimeTravel = (opts = { markStrategy: true, cursorReset: true }) => {
  if (opts.markStrategy) strategyManager.getIsUsingStrategy().set(true);
  if (opts.cursorReset) cursor.reset();
};
